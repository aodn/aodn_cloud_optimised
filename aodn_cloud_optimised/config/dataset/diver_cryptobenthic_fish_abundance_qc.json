{
  "dataset_name": "diver_cryptobenthic_fish_abundance_qc",
  "logger_name": "diver_cryptobenthic_fish_abundance_qc",
  "cloud_optimised_format": "parquet",
  "run_settings": {
    "paths": [
      {
        "s3_uri": "s3://imos-data/IMOS/NRMN",
        "filter": [
          "ep_m2_cryptic_fish_public_data\\.csv"
        ],
        "year_range": []
      }
    ],
    "cluster": {
      "mode": "local",
      "restart_every_path": false
    },
    "clear_existing_data": true,
    "raise_error": false,
    "coiled_cluster_options": {
      "n_workers": [
        1,
        20
      ],
      "scheduler_vm_types": "m7i-flex.large",
      "worker_vm_types": "m7i-flex.large",
      "allow_ingress_from": "me",
      "compute_purchase_option": "spot_with_fallback",
      "worker_options": {
        "nthreads": 4,
        "memory_limit": "8GB"
      }
    },
    "batch_size": 1,
    "force_previous_parquet_deletion": false
  },
  "metadata_uuid": "9efa25cd-4da4-47b5-9385-45e3cbd11705",
  "schema": {
    "survey_id": {
      "type": "int32",
      "long_name": "survey identification number"
    },
    "country": {
      "type": "string",
      "long_name": "country where the survey was conducted"
    },
    "area": {
      "type": "string",
      "long_name": "state/territory where the survey was conducted"
    },
    "ecoregion": {
      "type": "string",
      "long_name": "ecological region where the survey was conducted"
    },
    "realm": {
      "type": "string",
      "long_name": "realm where the survey was conducted"
    },
    "location": {
      "type": "string",
      "long_name": "city/council where the survey was conducted"
    },
    "site_code": {
      "type": "string",
      "long_name": "code for the survey site"
    },
    "site_name": {
      "type": "string",
      "long_name": "name of the survey site"
    },
    "latitude": {
      "type": "float32",
      "standard_name": "latitude",
      "long_name": "latitude of the site",
      "units": "degrees_north",
      "reference_datum": "geographical coordinates, WGS84 projection"
    },
    "longitude": {
      "type": "float32",
      "standard_name": "longitude",
      "long_name": "longitude of the site",
      "units": "degrees_east",
      "reference_datum": "geographical coordinates, WGS84 projection"
    },
    "survey_date": {
      "type": "string",
      "long_name": "local date",
      "units": "yyyy-mm-dd"
    },
    "depth": {
      "type": "float32",
      "standard_name": "depth",
      "long_name": "Depth below surface of the water body",
      "units": "m"
    },
    "program": {
      "type": "string",
      "long_name": "acronym identifying the program(s)"
    },
    "visibility": {
      "type": "float32",
      "long_name": "the distance in water at which something can be seen",
      "units": "m"
    },
    "hour": {
      "type": "string",
      "long_name": "local time of sample collection",
      "units": "HH:mm:ss",
      "units_standard": "ISO 8601"
    },
    "survey_latitude": {
      "type": "float32",
      "long_name": "latitude of the survey"
    },
    "survey_longitude": {
      "type": "float32",
      "long_name": "longitude of the survey"
    },
    "method": {
      "type": "int32",
      "long_name": "identifier for method applied to collect the observation"
    },
    "block": {
      "type": "int32",
      "long_name": "number of the block"
    },
    "phylum": {
      "type": "string",
      "long_name": "identification of the biotic elements to the scientific classification group"
    },
    "class_": {
      "type": "string",
      "long_name": "identification of the biotic elements to the scientific classification group"
    },
    "order": {
      "type": "string",
      "long_name": "identification of the biotic elements to the scientific classification group"
    },
    "family": {
      "type": "string",
      "long_name": "identification of the biotic elements to the scientific classification group"
    },
    "species_name": {
      "type": "string",
      "long_name": "identification of the biotic elements to the scientific classification group"
    },
    "reporting_name": {
      "type": "string",
      "long_name": "reporting name for the observed species"
    },
    "size_class": {
      "type": "float32",
      "long_name": "size class",
      "units": "cm"
    },
    "total": {
      "type": "int32",
      "long_name": "total number of observations"
    },
    "biomass": {
      "type": "float32",
      "long_name": "estimated biomass",
      "units": "g"
    },
    "geom": {
      "type": "string",
      "long_name": "geometry of the observation point"
    }
  },
  "aws_opendata_registry": {
    "Name": "National Reef Monitoring Network - Global cryptobenthic fish abundance",
    "Description": "The National Reef Monitoring Network brings together shallow reef surveys conducted around Australia into a centralised database. The IMOS National Reef Monitoring Network sub-Facility collates, cleans, stores and makes this data rapidly available from contributors including: Reef Life Survey, Parks Australia, Department of Biodiversity, Conservation and Attractions (Western Australia), Department of Environment, Water and Natural Resources (South Australia), Department of Primary Industries (New South Wales), Tasmanian Parks and Wildlife Service and Parks Victoria.\n\nThe data provided by the National Reef Monitoring Network contributes to establishing and supporting national marine baselines, and assisting with the management of Commonwealth and State marine reserves. \n\nReef Life Survey (RLS) and the Australian Temperate Reef Network (ATRC) aims to improve biodiversity conservation and the sustainable management of marine resources by coordinating surveys of rocky and coral reefs using scientific methods, with the ultimate goal to improve coastal stewardship. Our activities depend on the skills of marine scientists, experienced and motivated recreational SCUBA divers, partnerships with management agencies and university researchers, and active input from the ATRC partners and RLS Advisory Committee.\n\nRLS and ATRC data are freely available to the public for non-profit purposes, so not only managers, but also groups such as local dive clubs or schools may use these data to look at changes over time in their own local reefs. By making data freely available and through public outputs, RLS and ATRC aims to raise broader community awareness of the status of Australia?s marine biodiversity and associated conservation issues.\n\nThis dataset contains records of cryptobenthic fishes collected by RLS and ATRC divers and partners along 50m transects on shallow rocky and coral reefs using standard methods. Abundance information is available for all species recorded within quantitative survey limits (50 x 1 m swathes either side of the transect line, each distinguished as a 'Block'), with divers searching the reef surface (including cracks) carefully for hidden fishes. These observations are recorded concurrently with the macroinvertebrate observations and together make up the 'Method 2' component of the surveys. For this method, typically one 'Block' is completed per 50 m transect for the program ATRC and 2 blocks are completed for RLS ? although exceptions to this rule exist.\n\nThis dataset supersedes the RLS specific \"Reef Life Survey (RLS): Cryptic Fish\" collection that was available at https://catalogue-rls.imas.utas.edu.au/geonetwork/srv/en/metadata.show?uuid=6a56db3f-d1b2-438d-98c6-bd7dd540a4d5 (provision of data was stopped in June 2021).",
    "Documentation": "https://catalogue-imos.aodn.org.au/geonetwork/srv/eng/catalog.search#/metadata/9efa25cd-4da4-47b5-9385-45e3cbd11705",
    "Contact": "info@aodn.org.au",
    "ManagedBy": "AODN",
    "UpdateFrequency": "As Needed",
    "Tags": [
      "oceans",
      "biology",
      "coral reef",
      "ecosystems",
      "geospatial",
      "fisheries"
    ],
    "License": "http://creativecommons.org/licenses/by/4.0/",
    "Resources": [
      {
        "Description": "Cloud Optimised AODN dataset of IMOS - National Reef Monitoring Network Sub-Facility - Global cryptobenthic fish abundance",
        "ARN": "arn:aws:s3:::aodn-cloud-optimised/diver_cryptobenthic_fish_abundance_qc.parquet",
        "Region": "ap-southeast-2",
        "Type": "S3 Bucket"
      }
    ],
    "DataAtWork": {
      "Tutorials": [
        {
          "Title": "Accessing IMOS - National Reef Monitoring Network Sub-Facility - Global cryptobenthic fish abundance",
          "URL": "https://github.com/aodn/aodn_cloud_optimised/blob/main/notebooks/diver_cryptobenthic_fish_abundance_qc.ipynb",
          "NotebookURL": "https://githubtocolab.com/aodn/aodn_cloud_optimised/blob/main/notebooks/diver_cryptobenthic_fish_abundance_qc.ipynb",
          "AuthorName": "Laurent Besnard",
          "AuthorURL": "https://github.com/aodn/aodn_cloud_optimised"
        },
        {
          "Title": "Accessing and search for any AODN dataset",
          "URL": "https://github.com/aodn/aodn_cloud_optimised/blob/main/notebooks/GetAodnData.ipynb",
          "NotebookURL": "https://githubtocolab.com/aodn/aodn_cloud_optimised/blob/main/notebooks/GetAodnData.ipynb",
          "AuthorName": "Laurent Besnard",
          "AuthorURL": "https://github.com/aodn/aodn_cloud_optimised"
        }
      ]
    },
    "Citation": "The citation in a list of references is: \"Reef Life Survey (RLS); Institute for Marine and Antarctic Studies (IMAS); Parks Victoria; Department of Primary Industries (DPI), New South Wales Government; Parks and Wildlife Tasmania; Department for Environment and Water (DEWNR), South Australia, Integrated Marine Observing System (IMOS), [year-of-data-download], IMOS - National Reef Monitoring Network - Global cryptobenthic fish abundance, [data-access-URL], accessed [date-of-access].\""
  },
  "csv_config": {
    "polars_read_csv_config": {
      "separator": ",",
      "has_header": true,
      "null_values": [
        "N/A",
        "NaN"
      ],
      "try_parse_dates": false,
      "infer_schema_length": 1000,
      "encoding": "utf-8"
    }
  },
  "schema_transformation": {
    "drop_variables": [],
    "add_variables": {
      "filename": {
        "source": "@filename",
        "schema": {
          "type": "string",
          "units": "1",
          "long_name": "Filename of the source file"
        }
      },
      "timestamp": {
        "source": "@partitioning:time_extent",
        "schema": {
          "type": "int64",
          "units": "1",
          "long_name": "Partition timestamp"
        }
      },
      "polygon": {
        "source": "@partitioning:spatial_extent",
        "schema": {
          "type": "string",
          "units": "1",
          "long_name": "Spatial partition polygon"
        }
      },
      "TIME": {
        "source": "@function:time_creation",
        "schema": {
          "type": "timestamp[ns]",
          "units": "days since 1970-01-01T00:00:00Z",
          "_FillValue": "",
          "long_name": "Derived timestamp"
        }
      }
    },
    "functions": {
      "time_creation": {
        "extract_method": "from_variables",
        "method": {
          "creation_code": "def time_creation_from_variables(df):\n    import pandas as pd\n    date_col = df.get('survey_date')\n    hour_col = df.get('hour')\n\n    # Fill missing hour with 00:00:00\n    if hour_col is None:\n        hour_col = pd.Series(['00:00:00']*len(df), index=df.index)\n    else:\n        hour_col = hour_col.fillna('00:00:00')\n\n    # Combine date and hour strings\n    dt_str = date_col.astype(str) + ' ' + hour_col.astype(str)\n    result = pd.to_datetime(dt_str, errors='coerce', format='%Y-%m-%d %H:%M:%S')\n    # fallback to just date if conversion failed\n    mask = result.isna()\n    if mask.any():\n        result.loc[mask] = pd.to_datetime(date_col[mask], errors='coerce')\n    return result"
        }
      }
    },
    "partitioning": [
      {
        "source_variable": "timestamp",
        "type": "time_extent",
        "time_extent": {
          "time_varname": "TIME",
          "partition_period": "Y"
        }
      },
      {
        "source_variable": "polygon",
        "type": "spatial_extent",
        "spatial_extent": {
          "lat_varname": "latitude",
          "lon_varname": "longitude",
          "spatial_resolution": 10
        }
      }
    ],
    "global_attributes": {
      "delete": [
        "geospatial_lat_max",
        "geospatial_lat_min",
        "geospatial_lon_max",
        "geospatial_lon_min",
        "date_created"
      ],
      "set": {
        "title": "IMOS - National Reef Monitoring Network Sub-Facility - Global off-transect species observations"
      }
    }
  }
}
